## ****************************************************************************
## ****************************************************************************
## Copyright SoC Design Research Group, All rights reserved.    
## Electronics and Telecommunications Research Institute (ETRI)
##
## THESE DOCUMENTS CONTAIN CONFIDENTIAL INFORMATION AND KNOWLEDGE 
## WHICH IS THE PROPERTY OF ETRI. NO PART OF THIS PUBLICATION IS 
## TO BE USED FOR ANY OTHER PURPOSE, AND THESE ARE NOT TO BE 
## REPRODUCED, COPIED, DISCLOSED, TRANSMITTED, STORED IN A RETRIEVAL 
## SYSTEM OR TRANSLATED INTO ANY OTHER HUMAN OR COMPUTER LANGUAGE, 
## IN ANY FORM, BY ANY MEANS, IN WHOLE OR IN PART, WITHOUT THE 
## COMPLETE PRIOR WRITTEN PERMISSION OF ETRI.
## ****************************************************************************
## 2023-01-26
## Kyuseung Han (han@etri.re.kr)
## ****************************************************************************
## ****************************************************************************

## How to init GIT
# copy rvx_init.mh
# make config_python
# edit "rvx_python_config.mh"
# make check_python

## How to generate GIT
# write ORIGINAL_GIT into each_test_sw.mh
# make all

## How to config GIT
# make config_python
# edit "rvx_python_config.mh"
# make check_python
# make config
# source ./source
# make setup

## How to generate GIT 2
# config first!
# source ./source
# make platform
# add files into GIT manually

ifndef RVX_UTIL_HOME
	RVX_UTIL_HOME=./rvx_util
endif

TEMPLATE_FILE = ${RVX_ENV}/release/Makefile.test_sw.template
include ${RVX_UTIL_HOME}/template_makefile.mh

-include ./rvx_config.mh
include ./rvx_init.mh
-include ./each_test_sw.mh

ORIGINAL_FILE_LIST=./README.md ./Makefile ./rvx_init.mh
include ${RVX_UTIL_HOME}/distclean.mh

TARGET_LIST=.gitignore git_info rvx_export.source imp_class_info rvx_util rvx_ssw rvx_synthesizer_binary rvx_binary rvx_devkit local_setup

all: $(addprefix copy., ${TARGET_LIST})

clean: $(addprefix clean., ${TARGET_LIST})

$(addprefix clean., ${TARGET_LIST}):clean.%:
	-@git rm -rf ./$(*)
	-@rm -rf ./$(*)

$(addprefix copy., ${TARGET_LIST}):copy.%: clean.%
	@if [ -a ${ORIGINAL_GIT}/$(*) ]; \
	then \
		cp -r ${ORIGINAL_GIT}/$(*) .; \
		git add -A ./$(*); \
	fi

copy.local_setup:
	-git rm -rf ./local_setup/
	-rm -rf ./local_setup
	cp -r ${ORIGINAL_GIT}/local_setup .
	git add -f ./local_setup/Makefile

platform:
	-@git rm -rf ./platform
	-@rm -rf ./platform
	cp -r ${ORIGINAL_GIT}/platform .

config:
	-rm -f .rvx_*
	-cd ./rvx_binary && make config
	${PYTHON3_CMD} ${RVX_UTIL_HOME}/configure_template.py -i ${CURDIR}/rvx_export.source -o ./source -c RVX_EXPORT_HOME=$(CURDIR)

setup:
	@if [ ! -d ./platform ]; \
	then \
		mkdir platform; \
	fi
	cd ./rvx_binary && make compiler
	cd ./local_setup && make gui ocd

.PHONY: ${TARGET_LIST} platform

