#include "test_matrix.h"

#include "core_dependent.h"
#include "ervp_variable_allocation.h"
#include "ervp_float.h"
#include "ervp_printf.h"
#include "ervp_assert.h"
#include "ervp_matrix_element.h"
static const float test_matrix_0[16][16] = {
    { 0.000f,  0.022f,  0.044f,  0.066f,  0.088f,  0.110f,  0.132f,  0.154f,  0.176f,  0.198f,  0.220f,  0.242f,  0.264f,  0.286f,  0.308f,  0.330f},
    { 0.011f,  0.033f,  0.055f,  0.077f,  0.099f,  0.121f,  0.143f,  0.165f,  0.187f,  0.209f,  0.231f,  0.253f,  0.275f,  0.297f,  0.319f,  0.341f},
    { 0.022f,  0.044f,  0.066f,  0.088f,  0.110f,  0.132f,  0.154f,  0.176f,  0.198f,  0.220f,  0.242f,  0.264f,  0.286f,  0.308f,  0.330f,  0.352f},
    { 0.033f,  0.055f,  0.077f,  0.099f,  0.121f,  0.143f,  0.165f,  0.187f,  0.209f,  0.231f,  0.253f,  0.275f,  0.297f,  0.319f,  0.341f,  0.363f},
    { 0.044f,  0.066f,  0.088f,  0.110f,  0.132f,  0.154f,  0.176f,  0.198f,  0.220f,  0.242f,  0.264f,  0.286f,  0.308f,  0.330f,  0.352f,  0.374f},
    { 0.055f,  0.077f,  0.099f,  0.121f,  0.143f,  0.165f,  0.187f,  0.209f,  0.231f,  0.253f,  0.275f,  0.297f,  0.319f,  0.341f,  0.363f,  0.385f},
    { 0.066f,  0.088f,  0.110f,  0.132f,  0.154f,  0.176f,  0.198f,  0.220f,  0.242f,  0.264f,  0.286f,  0.308f,  0.330f,  0.352f,  0.374f,  0.396f},
    { 0.231f,  0.099f,  0.121f,  0.143f,  0.165f,  0.187f,  0.209f,  0.693f,  0.253f,  0.275f,  0.297f,  0.319f,  0.341f,  0.363f,  0.385f,  0.407f},
    { 0.088f,  0.110f,  0.132f,  0.154f,  0.176f,  0.198f,  0.220f,  0.242f,  0.264f,  0.286f,  0.308f,  0.330f,  0.352f,  0.374f,  0.396f,  0.418f},
    { 0.099f,  0.121f,  0.143f,  0.165f,  0.187f,  0.209f,  0.231f,  0.253f,  0.275f,  0.297f,  0.319f,  0.341f,  0.363f,  0.385f,  0.407f,  0.429f},
    { 0.110f,  0.132f,  0.154f,  0.176f,  0.198f,  0.220f,  0.242f,  0.264f,  0.286f,  0.308f,  0.330f,  0.352f,  0.374f,  0.396f,  0.418f,  0.440f},
    { 0.121f,  0.143f,  0.165f,  0.187f,  0.209f,  0.231f,  0.253f,  0.275f,  0.297f,  0.319f,  0.341f,  0.363f,  0.385f,  0.407f,  0.429f,  0.451f},
    { 0.132f,  0.154f,  0.176f,  0.198f,  0.220f,  0.242f,  0.264f,  0.286f,  0.308f,  0.330f,  0.352f,  0.374f,  0.396f,  0.418f,  0.440f,  0.462f},
    { 0.143f,  0.165f,  0.187f,  0.209f,  0.231f,  0.253f,  0.275f,  0.297f,  0.319f,  0.341f,  0.363f,  0.385f,  0.407f,  0.429f,  0.451f,  0.473f},
    { 0.462f,  0.176f,  0.198f,  0.220f,  0.242f,  0.264f,  0.286f,  0.308f,  0.330f,  0.352f,  0.374f,  0.396f,  0.924f,  0.440f,  0.462f,  0.484f},
    { 0.165f,  0.187f,  0.209f,  0.231f,  0.253f,  0.275f,  0.297f,  0.319f,  0.341f,  0.363f,  0.385f,  0.407f,  0.429f,  0.451f,  0.473f,  0.495f}
};

// 또는 더 현실적인 CNN 가중치 (음수 포함, He initialization 스타일)
static const float test_matrix_cnn[16][16] = {
    {-0.124f,  0.087f, -0.043f,  0.156f, -0.098f,  0.021f, -0.187f,  0.134f,  0.065f, -0.112f,  0.198f, -0.076f,  0.143f, -0.054f,  0.167f, -0.089f},
    { 0.045f, -0.178f,  0.092f, -0.067f,  0.134f, -0.023f,  0.156f, -0.098f,  0.043f,  0.187f, -0.134f,  0.076f, -0.021f,  0.165f, -0.112f,  0.054f},
    {-0.098f,  0.156f, -0.021f,  0.178f, -0.087f,  0.043f, -0.165f,  0.112f,  0.089f, -0.134f,  0.023f,  0.198f, -0.045f,  0.076f, -0.156f,  0.067f},
    { 0.178f, -0.043f,  0.134f, -0.089f,  0.021f,  0.165f, -0.076f,  0.054f, -0.198f,  0.112f, -0.023f,  0.156f, -0.087f,  0.045f, -0.134f,  0.098f},
    {-0.065f,  0.112f, -0.156f,  0.045f,  0.187f, -0.098f,  0.023f, -0.143f,  0.076f,  0.165f, -0.054f,  0.089f, -0.178f,  0.134f, -0.021f,  0.156f},
    { 0.134f, -0.089f,  0.021f,  0.198f, -0.112f,  0.054f, -0.187f,  0.098f,  0.043f, -0.076f,  0.165f, -0.134f,  0.023f,  0.156f, -0.089f,  0.045f},
    {-0.021f,  0.165f, -0.087f,  0.043f, -0.178f,  0.134f,  0.076f, -0.112f,  0.198f, -0.045f,  0.089f, -0.156f,  0.067f,  0.098f, -0.187f,  0.054f},
    { 0.287f, -0.076f,  0.198f, -0.134f,  0.045f,  0.089f, -0.465f,  0.021f,  0.156f, -0.098f,  0.043f,  0.187f, -0.112f,  0.065f, -0.165f,  0.134f},
    {-0.087f,  0.134f, -0.045f,  0.176f, -0.089f,  0.021f, -0.156f,  0.112f,  0.098f, -0.143f,  0.054f,  0.187f, -0.076f,  0.023f, -0.134f,  0.165f},
    { 0.098f, -0.021f,  0.156f, -0.087f,  0.043f,  0.198f, -0.134f,  0.065f, -0.178f,  0.112f, -0.023f,  0.076f, -0.165f,  0.089f,  0.054f, -0.143f},
    {-0.112f,  0.187f, -0.054f,  0.098f, -0.165f,  0.076f,  0.023f, -0.189f,  0.134f,  0.045f, -0.156f,  0.098f, -0.043f,  0.178f, -0.112f,  0.021f},
    { 0.156f, -0.098f,  0.043f,  0.134f, -0.021f,  0.187f, -0.112f,  0.054f, -0.076f,  0.165f, -0.089f,  0.023f,  0.198f, -0.134f,  0.045f, -0.156f},
    {-0.043f,  0.076f, -0.178f,  0.021f,  0.156f, -0.098f,  0.045f, -0.134f,  0.187f, -0.054f,  0.112f, -0.165f,  0.089f,  0.023f, -0.198f,  0.067f},
    { 0.065f, -0.156f,  0.089f, -0.043f,  0.198f, -0.134f,  0.076f,  0.021f, -0.112f,  0.187f, -0.045f,  0.054f, -0.143f,  0.165f, -0.023f,  0.098f},
    {-0.398f,  0.023f, -0.134f,  0.187f, -0.076f,  0.043f, -0.165f,  0.098f,  0.054f, -0.021f,  0.178f, -0.112f,  0.589f, -0.089f,  0.156f, -0.045f},
    { 0.187f, -0.112f,  0.021f,  0.065f, -0.143f,  0.156f, -0.054f,  0.187f, -0.098f,  0.043f, -0.134f,  0.089f,  0.165f, -0.076f,  0.023f, -0.198f}
};
void generate_test_matrix(ErvpMatrixInfo* matrix_info, int index)
{
  int i,j;
  int invert = 0;
  int index2 = index % 5;

  assert(matrix_info);
  assert(matrix_info->addr);

  if(matrix_info->datatype==MATRIX_DATATYPE_FLOAT32)
  {
    for(j=0; j<matrix_info->num_row; j++)
      for(i=0; i<matrix_info->num_col; i++)
      {
        float value;
        if(index2==0){
          value = (float)((float)j*0.666F + (float)(i + 1)*1.4F);
        }
        else{
          value = (float)((float)i*0.666F + (float)(j + 1)*1.4F);
        }
        matrix_write_float_element(matrix_info, j, i, value);
      }
  }
  else
  {
    for(j=0; j<matrix_info->num_row; j++)
      for(i=0; i<matrix_info->num_col; i++)
      {
        int value;
        switch(index2)
        {
          case 0:
            value = j*matrix_info->num_col + i + 1 - 4;
            break;
          case 1:
            value = j*matrix_info->num_col + i + 8;
            break;
          case 2:
            value = i*matrix_info->num_col + j - 6;
            break;
          case 3:
            value = ((j*matrix_info->num_col + i + 1)>>3) - 8;
            break;
          case 4:
            value = ((j*matrix_info->num_col + i + 1)&7) - 4;
            break;
          default:
            value = 0;
            assert(0);
        }
        if(invert==2)
        {
          value = -value;
          invert = 0;
        }
        else
          invert++;
        matrix_write_fixed_element(matrix_info, j, i, value);
      }
  }
}